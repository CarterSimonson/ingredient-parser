
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>User Guide &#8212; Ingredient Parser 0.1.0-alpha1 documentation</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "dark";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user/index';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../reference/index.html" />
    <link rel="prev" title="Getting Started" href="../start/index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="dark">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fas fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">Ingredient Parser 0.1.0-alpha1 documentation</p>
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../start/index.html">
                        Getting Started
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="#">
                        User Guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../reference/index.html">
                        API Reference
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fas fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../start/index.html">
                        Getting Started
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="#">
                        User Guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../reference/index.html">
                        API Reference
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="user-guide">
<h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this heading">#</a></h1>
<section id="data-sources">
<h2>Data Sources<a class="headerlink" href="#data-sources" title="Permalink to this heading">#</a></h2>
<p>There are two sources of data which will be used to train the model, each with their own advantages and disadvantages.</p>
<section id="strangerfoods">
<h3>StrangerFoods<a class="headerlink" href="#strangerfoods" title="Permalink to this heading">#</a></h3>
<p>The recipes from my website: <a class="reference external" href="https://strangerfoods.org">https://strangerfoods.org</a>.</p>
<ul class="simple">
<li><p>The dataset is extremely clean and well labelled. This isn’t a particularly useful feature.</p></li>
<li><p>The dataset primarily uses metric units</p></li>
<li><p>The dataset is small, roughly 7100 entries</p></li>
</ul>
</section>
<section id="new-york-times">
<h3>New York Times<a class="headerlink" href="#new-york-times" title="Permalink to this heading">#</a></h3>
<p>The New York Times released a dataset of labelled ingredients in their <a class="reference external" href="https://github.com/NYTimes/ingredient-phrase-tagger">Ingredient Phrase Tagger</a> repository, which had the same goal as this.</p>
<ul class="simple">
<li><p>The dataset isn’t very clean and the labelling is suspect in places.</p></li>
<li><p>The dataset primarily uses imperial/US customary units</p></li>
<li><p>The dataset is large, roughly 178,000 entries</p></li>
</ul>
<p>The two datasets have different advantages and disadvantages, therefore combining the two should yield an improvement.</p>
</section>
</section>
<section id="processing-the-data">
<h2>Processing the Data<a class="headerlink" href="#processing-the-data" title="Permalink to this heading">#</a></h2>
<p>The model chosen is a condition random fields model. This was selected because the NYTimes work on this used the same model. Rather than re-using the same tools and process the NYTimes did, this will implemented purely in <code class="docutils literal notranslate"><span class="pre">python</span></code> using my own ideas (although they are obviously influenced by the NYTimes work).</p>
<p>Step 1 is pre-processing the data. We need to do the following things to it:</p>
<ol class="arabic simple">
<li><p>Replace fractions with a uniform representation</p></li>
<li><p>Tokenize each ingredient sentence</p></li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">`PreProcessor`</span></code> class handles this for us. All fractions are replaced with decimals and a custom tokenizer is used to split the sentence up so that words, commas, parantheses and quotes counted as tokens.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">Preprocess</span> <span class="kn">import</span> <span class="n">PreProcessor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">PreProcessor</span><span class="p">(</span><span class="s2">&quot;1/2 cup orange juice, freshly squeezed&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">sentence</span>
<span class="go">&#39;0.5 cup orange juice, freshly squeezed&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">tokenized_sentence</span>
<span class="go">[&#39;0.5&#39;, &#39;cup&#39;, &#39;orange&#39;, &#39;juice&#39;, &#39;,&#39;, &#39;freshly&#39;, &#39;squeezed&#39;]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">_clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Clean sentence prior to feature extraction</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sentence : str</span>
<span class="sd">            Ingredient sentence</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Clean ingredient sentence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># List of funtions to apply to sentence</span>
        <span class="c1"># Note that the order matters</span>
        <span class="n">funcs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_replace_string_numbers</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_replace_html_fractions</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_replace_unicode_fractions</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_replace_fake_fractions</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_split_quantity_and_units</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_replace_string_range</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_singlarise_unit</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
            <span class="n">sentence</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sentence</span>
</pre></div>
</div>
</section>
<section id="extracting-features">
<h2>Extracting Features<a class="headerlink" href="#extracting-features" title="Permalink to this heading">#</a></h2>
<p>Step 2 is to extract the features for each token in the sentence. The selected features are as follows:</p>
<ul class="simple">
<li><p>The token</p></li>
<li><p>The previous token (or an empty string if the first token)</p></li>
<li><p>The token 2 tokens previous (or an empty string if the second or first token)</p></li>
<li><p>The next token (or an empty string if the last token)</p></li>
<li><p>The token 2 tokens after (or an empty string if the last or second last token)</p></li>
<li><p>Whether the token is inside parentheses</p></li>
<li><p>If the token is capitalised</p></li>
<li><p>If the token is numeric</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">token_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Return the features for each token in the sentence</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            Index of token to get features for.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, Any]</span>
<span class="sd">            Dictionary of features for token at index</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenized_sentence</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;word&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span>
        <span class="s2">&quot;prev_word&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenized_sentence</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;prev_word2&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenized_sentence</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span>
        <span class="s2">&quot;next_word&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_sentence</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenized_sentence</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;next_word2&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_sentence</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenized_sentence</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
        <span class="s2">&quot;is_capitalised&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_capitalised</span><span class="p">(</span><span class="n">token</span><span class="p">),</span>
        <span class="s2">&quot;is_numeric&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_numeric</span><span class="p">(</span><span class="n">token</span><span class="p">),</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>It’s likely that some of these features aren’t necessary, but I haven’t done the analysis to look at the impact of removing each one.</p>
<p>Step 3 is to train the model. The two datasets are combined and split into training and testing sets. The NYTimes data is limited to the first 30,000 entries to prevent it overwhelming the StrangerFoods data.</p>
<p>The training and testing data is transformed to get it’s features and correct labelling</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">transform_to_dataset</span><span class="p">(</span><span class="n">sentences</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;Transform dataset into feature lists for each sentence</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sentences : List[str]</span>
<span class="sd">        Sentences to transform</span>
<span class="sd">    labels : List[Dict[str, str]]</span>
<span class="sd">        Labels for tokens in each sentence</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[Dict[str, str]]</span>
<span class="sd">        List of transformed sentences</span>
<span class="sd">     List[str]</span>
<span class="sd">        List of transformed labels</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">sentence</span><span class="p">,</span> <span class="n">labels</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">PreProcessor</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sentence_features</span><span class="p">())</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">match_label</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">tokenized_sentence</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">labels</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">tokenized_sentence</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">transform_to_dataset</span><span class="p">(</span><span class="n">ingredients_train</span><span class="p">,</span> <span class="n">labels_train</span><span class="p">)</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">transform_to_dataset</span><span class="p">(</span><span class="n">ingredients_test</span><span class="p">,</span> <span class="n">labels_test</span><span class="p">)</span>
</pre></div>
</div>
<p>The tokens have to be matched to the label because not all words in each entry are labelled. The <code class="docutils literal notranslate"><span class="pre">match_label</span></code> function does this, although imperfectly since it does not handle a word appearing multiple times in a sentence</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">match_label</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Match a token to it&#39;s label</span>
<span class="sd">    This is naive in that it assumes a token can only have one label with the sentence</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    token : str</span>
<span class="sd">        Token to match</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Label for token, or None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Make lower case first, beccause all labels are lower case</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">singlarise_unit</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">[</span><span class="s2">&quot;quantity&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;QTY&quot;</span>
    <span class="k">elif</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">[</span><span class="s2">&quot;unit&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;UNIT&quot;</span>
    <span class="k">elif</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;NAME&quot;</span>
    <span class="k">elif</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;COMMENT&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;OTHER&quot;</span>
</pre></div>
</div>
</section>
<section id="training-the-model">
<h2>Training the Model<a class="headerlink" href="#training-the-model" title="Permalink to this heading">#</a></h2>
<p>With the data ready, we can now train the model using <a class="reference external" href="https://github.com/scrapinghub/python-crfsuite">python-crfuite</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pycrfsuite</span>

<span class="n">trainer</span> <span class="o">=</span> <span class="n">pycrfsuite</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">):</span>
    <span class="n">trainer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="s2">&quot;model.crfsuite&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we can evaluate the model using the test data. For each entry in the test data, we use the model to predict the labels then calculate the accuracy score.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">tagger</span> <span class="o">=</span> <span class="n">pycrfsuite</span><span class="o">.</span><span class="n">Tagger</span><span class="p">()</span>
<span class="n">tagger</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;model.crfsuite&quot;</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">tagger</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="n">X_test</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
<span class="c1"># 0.9169...</span>
</pre></div>
</div>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="../start/index.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Getting Started</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../reference/index.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">API Reference</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fas fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-sources">
   Data Sources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#strangerfoods">
     StrangerFoods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#new-york-times">
     New York Times
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#processing-the-data">
   Processing the Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extracting-features">
   Extracting Features
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#training-the-model">
   Training the Model
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/user/index.rst.txt">
        <i class="fas fa-file-alt"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022, Tom Strange.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>